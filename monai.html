<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MONAI - Data Science Cheat Codes</title>
    
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
    <div class="bg-blobs"><span></span><span></span><span></span></div>
    <a class="skip-link" href="#content" style="position:absolute;left:-9999px;top:auto;">Skip to content</a>
    <div id="tsparticles"></div>
    
    <nav id="sidebar">
        <button id="sidebar-toggle"><i class="fa-solid fa-bars"></i></button>
        <ul class="sidebar-nav">
            <li class="nav-item"><a href="index.html"><i class="fa-solid fa-house nav-icon"></i><span class="nav-text">Home</span></a></li>
            <li class="nav-item"><a href="matplotlib.html"><i class="fa-solid fa-chart-pie nav-icon"></i><span class="nav-text">Matplotlib</span></a></li>
            <li class="nav-item"><a href="seaborn.html"><i class="fa-solid fa-water nav-icon"></i><span class="nav-text">Seaborn</span></a></li>
            <li class="nav-item"><a href="pandas.html"><i class="fa-solid fa-table nav-icon"></i><span class="nav-text">Pandas</span></a></li>
            <li class="nav-item"><a href="scikitlearn.html"><i class="fa-solid fa-robot nav-icon"></i><span class="nav-text">Scikit-learn</span></a></li>
            <li class="nav-item"><a href="torch.html"><i class="fa-solid fa-brain nav-icon"></i><span class="nav-text">PyTorch</span></a></li>
            <li class="nav-item"><a href="monai.html"><i class="fa-solid fa-lungs nav-icon"></i><span class="nav-text">MONAI</span></a></li>
            <li class="nav-item"><a href="transformers.html"><i class="fa-solid fa-language nav-icon"></i><span class="nav-text">Transformers</span></a></li>
            <li class="nav-item"><a href="tensorflow.html"><i class="fa-solid fa-square-caret-right nav-icon"></i><span class="nav-text">TensorFlow</span></a></li>
            <li class="nav-item"><a href="about.html"><i class="fa-solid fa-user-circle nav-icon"></i><span class="nav-text">About</span></a></li>
        </ul>
        <div class="sidebar-footer">
            <button id="theme-toggle" title="Ganti Tema">
                <i class="fas fa-moon icon-moon"></i>
                <i class="fas fa-sun icon-sun"></i>
            </button>
        </div>
    </nav>

    <div id="main-content">
        <header>
            <h1>Deep Learning untuk Citra Medis dengan MONAI</h1>
            <p>Alur kerja lengkap yang bisa dijalankan untuk klasifikasi gambar medis.</p>
        </header>
        <main>
            <h2>Klasifikasi Gambar MedNIST (Lengkap)</h2>
            <div class="card-container">

                <!-- KARTU TUNGGAL UNTUK ALUR KERJA LENGKAP -->
                <div class="card">
                    <div class="card-inner">
                        <h3>Alur Kerja Lengkap Klasifikasi MedNIST</h3>
                        <!-- Anda perlu membuat gambar hasil prediksi dari kode di bawah -->
                        <img src="https://github.com/paijolemu/cheatcode_datascience/blob/main/images/monai_hand.jpg?raw=true" alt="Contoh Prediksi MONAI">
                        <div class="code-block">
                            <div class="code-block-header"><div class="code-block-dots"><div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div></div><button class="copy-button">Copy</button></div>
                            <pre><code># === CELL 1 ===
%% capture
# Run this cell first. It reinstalls torch (cu118) and monai, then restarts the runtime.
!pip uninstall -y torch torchvision torchaudio
!pip cache purge
!pip install --index-url https://download.pytorch.org/whl/cu118 torch torchvision torchaudio --upgrade
!pip install --upgrade monai

# restart kernel so new torch is loaded
import os
print("Install selesai. Restarting runtime now...")
os.kill(os.getpid(), 9)

                                # === CELL 2 ===
# Paste & run setelah runtime reconnects.
import os, tempfile, glob, random, torch
import torch.nn as nn
import matplotlib.pyplot as plt
from monai.data import Dataset, DataLoader
from monai.transforms import (
    Compose, LoadImaged, EnsureChannelFirstd, ResizeWithPadOrCropd, ScaleIntensityd
)
from monai.apps import download_and_extract
from monai.networks.nets import DenseNet121

# ---------- config ----------
seed = 42
random.seed(seed)
torch.manual_seed(seed)
if torch.cuda.is_available():
    torch.cuda.manual_seed_all(seed)

device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
print("Device:", device, "torch:", torch.__version__)

# ---------- download MedNIST (MONAI extra test data) ----------
root_dir = tempfile.mkdtemp()
data_dir = os.path.join(root_dir, "MedNIST")
resource = "https://github.com/Project-MONAI/MONAI-extra-test-data/releases/download/0.8.1/MedNIST.tar.gz"
if not os.path.exists(data_dir):
    print("Download MedNIST ... (sekitar 60MB)")
    download_and_extract(resource, os.path.join(root_dir, "MedNIST.tar.gz"), root_dir)
    print("Download selesai.")

# ---------- file list & classes ----------
all_files = sorted(glob.glob(os.path.join(data_dir, "*", "*.jpeg")))
if len(all_files) == 0:
    raise RuntimeError("Gagal menemukan file MedNIST. Cek download path:", data_dir)

class_names = sorted({os.path.basename(os.path.dirname(f)) for f in all_files})
num_classes = len(class_names)
class_indices = {name: i for i, name in enumerate(class_names)}
files = [{"image": f, "label": class_indices[os.path.basename(os.path.dirname(f))]} for f in all_files]

# simple split: last 20% val
val_split = max(1, int(len(files) * 0.2))
train_files, val_files = files[:-val_split], files[-val_split:]
print(f"Total files: {len(files)}  train: {len(train_files)}  val: {len(val_files)}  classes: {class_names}")

# ---------- transforms & dataloaders ----------
image_size = (64, 64)
transforms = Compose([
    LoadImaged(keys=["image"]),
    EnsureChannelFirstd(keys=["image"]),                 # -> (C,H,W)
    ResizeWithPadOrCropd(keys=["image"], spatial_size=image_size),
    ScaleIntensityd(keys=["image"]),
])

train_ds = Dataset(data=train_files, transform=transforms)
val_ds = Dataset(data=val_files, transform=transforms)

train_loader = DataLoader(train_ds, batch_size=32, shuffle=True, num_workers=2)
val_loader = DataLoader(val_ds, batch_size=32, num_workers=2)

# ---------- model, loss, optim ----------
model = DenseNet121(spatial_dims=2, in_channels=1, out_channels=num_classes).to(device)
loss_function = nn.CrossEntropyLoss()
optimizer = torch.optim.Adam(model.parameters(), lr=1e-4)
max_epochs = 4

# ---------- training ----------
print("Start training...")
for epoch in range(max_epochs):
    model.train()
    epoch_loss = 0.0
    n_batches = 0
    for batch_data in train_loader:
        inputs = batch_data["image"].to(device)
        labels = batch_data["label"].to(device).long()
        optimizer.zero_grad()
        outputs = model(inputs)
        loss = loss_function(outputs, labels)
        loss.backward()
        optimizer.step()
        epoch_loss += loss.item()
        n_batches += 1
    avg_loss = epoch_loss / max(1, n_batches)
    print(f"Epoch {epoch+1}/{max_epochs}  avg_loss={avg_loss:.4f}")

# ---------- eval & visualisasi ----------
model.eval()
with torch.no_grad():
    val_batch = next(iter(val_loader))
    val_images = val_batch["image"].to(device)
    val_labels = val_batch["label"].to(device).long()
    val_outputs = model(val_images)
    predicted = torch.argmax(val_outputs, dim=1)

# plot few examples
plt.figure("check", (10, 5))
n_show = min(5, val_images.shape[0])
for i in range(n_show):
    plt.subplot(2, 5, i + 1)
    plt.imshow(val_images[i, 0].cpu(), cmap="gray")
    plt.axis("off")

    plt.subplot(2, 5, i + 6)
    correct = (val_labels[i] == predicted[i]).item()
    color = "green" if correct else "red"
    actual = class_names[int(val_labels[i].cpu())]
    predc = class_names[int(predicted[i].cpu())]
    plt.text(0.5, 0.5, f"Asli: {actual}\nPred: {predc}", ha="center", va="center", color=color)
    plt.axis("off")

plt.suptitle("Contoh Hasil Prediksi Model MONAI (DenseNet121)")
plt.show()

print("Selesai. Kalau ada error, ambil screenshot dan kirim. Tapi ini setup yang stabil di Colab.")
</code></pre>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-inner">
                        <h3>Bar Chart dengan Matplotlib</h3>
                        <img src="https://raw.githubusercontent.com/paijolemu/cheatcode_datascience/main/images/bar_chart_example.png" alt="Contoh Bar Chart">
                        <div class="code-block">
                            <div class="code-block-header">
                                <div class="code-block-dots">
                                    <div class="dot red"></div>
                                    <div class="dot yellow"></div>
                                    <div class="dot green"></div>
                                </div>
                                <button class="copy-button">Copy</button>
                            </div>
                            <pre><code>import matplotlib.pyplot as plt
from PIL import Image
import random

# Ambil 1 contoh gambar dari tiap kelas
plt.figure(figsize=(12, 6))

for i, cls in enumerate(classes):
    # ambil list file gambar
    files = os.listdir(os.path.join(data_dir, cls))

    # pilih 1 random
    sample_file = random.choice(files)
    img_path = os.path.join(data_dir, cls, sample_file)

    # buka gambar
    img = Image.open(img_path)

    # plot
    plt.subplot(2, 3, i+1)
    plt.imshow(img, cmap="gray")
    plt.title(cls)
    plt.axis("off")

plt.tight_layout()
plt.show()/code></pre>
                        </div>
                    </div>
                </div>
            </div>
            
        </main>
        
        <footer class="page-navigation">
            <nav class="post-nav" aria-label="Navigasi Artikel">
              <a class="post-nav-item prev" href="torch.html" data-thumb="https://raw.githubusercontent.com/paijolemu/cheatcode_datascience/main/images/pytorch_thumb.png">
                <div class="nav-thumb" role="img" aria-hidden="true"></div>
                <div class="nav-body">
                  <span class="nav-kicker">← Sebelumnya</span>
                  <span class="nav-title">PyTorch</span>
                  <span class="nav-desc">Contoh penggunaan dasar dan tips cepat</span>
                </div>
              </a>
            
              <a class="post-nav-item next" href="transformers.html" data-thumb="https://raw.githubusercontent.com/paijolemu/cheatcode_datascience/main/images/transformers_thumb.png">
                <div class="nav-thumb" role="img" aria-hidden="true"></div>
                <div class="nav-body">
                  <span class="nav-kicker">Selanjutnya →</span>
                  <span class="nav-title">Transformers</span>
                  <span class="nav-desc">Memahami attention & finetuning</span>
                </div>
              </a>
            </nav>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/tsparticles@2.12.0/tsparticles.bundle.min.js"></script>
    <script src="script.js?v=monai_page_final_fix"></script>
</body>
</html>
